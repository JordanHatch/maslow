<% content_for :page_title, "#{need.need_id}: #{format_need_goal(need.goal)}" %>

<article class="need">

  <%= render partial: "needs/breadcrumb", locals: { need: need } %>

  <%= render partial: "need_header" %>

  <p class="the-need well well-large">
    As a <%= need.role %><br />
    I need to <%= need.goal %><br />
    So that <%= need.benefit %>
  </p>

  <div class="need-wrapper row">
    <div class="col-md-8">
      <% if need.met_when.any? %>
        <h3>Need is met when the user</h3>
        <ul class="met-when">
          <% need.met_when.each do |criterion| %>
            <li><%= criterion %></li>
          <% end %>
        </ul>
      <% end %>

      <% if need.legislation.present? %>
        <div class="legislation">
          <h3>Related legislation</h3>
          <%= simple_format html_escape(need.legislation) %>
        </div>
      <% end %>

      <% if need.other_evidence.present? %>
        <div class="other-evidence">
          <h3>Further evidence</h3>
          <%= simple_format html_escape(need.other_evidence) %>
        </div>
      <% end %>
    </div>

    <% if show_interactions_column?(need) %>
      <div class="interactions col-md-4">
        <h3>Historical Interactions</h3>

        <% if need.yearly_need_views.present? %>
          <div class="big-number">
            <%= format_friendly_integer need.yearly_need_views %>
            <span class="big-number-detail">Approximate pageviews a year</span>
          </div>
        <% end %>

        <% if percentage = calculate_percentage(need.yearly_need_views, need.yearly_site_views) %>
          <div class="big-number">
            <%= percentage %>
            <span class="big-number-detail">of site pageviews</span>
          </div>
        <% end %>

        <% if need.yearly_user_contacts.present? %>
        <div class="big-number">
          <%= format_friendly_integer need.yearly_user_contacts %>
          <span class="big-number-detail">Approximate contacts a year</span>
        </div>
        <% end %>

        <% if need.yearly_searches.present? %>
          <div class="big-number">
            <%= format_friendly_integer need.yearly_searches %>
            <span class="big-number-detail">Approximate searches a year</span>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <%= render partial: "workflow_buttons", locals: { need: need } %>
</article>
